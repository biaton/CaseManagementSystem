{% extends "official_portal/base_official.html" %}
{% load static %}

{% block official_title %}Review Resident Application{% endblock %}

{% block extra_head_official %}
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
{% endblock %}

{% block official_content_main %}
<div class="bg-white p-6 md:p-8 rounded-lg shadow-md border"
     x-data="{ isIdModalOpen: false }">
    
    <!-- HEADER -->
    <div class="flex flex-col sm:flex-row items-start sm:items-center sm:justify-between mb-6 border-b pb-4">
        <div>
            <h2 class="text-3xl font-bold text-gray-800">Review Resident Application</h2>
            <!-- <p class="text-sm text-gray-500 mt-1">Verify the applicant's details and uploaded ID before activation.</p> -->
        </div>
        <a href="{% url 'manage_users' %}" class="mt-4 sm:mt-0 bg-gray-200 hover:bg-gray-300 text-gray-800 font-semibold py-2 px-4 rounded-lg inline-flex items-center text-sm">
            <i class="fas fa-arrow-left mr-2"></i>
            Back to User List
        </a>
    </div>

    <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
        <!-- LEFT SIDE: Applicant's Details -->
        <div class="space-y-6">
            <div>
                <h3 class="font-bold text-lg text-gray-700 border-b pb-2 mb-5">Personal Information</h3>
                <dl class="text-sm space-y-2">
                    <div class="grid grid-cols-3 gap-x-4">
                        <dt class="col-span-1 text-gray-500 text-lg font-semibold">Full Name:</dt>
                        <dd class="col-span-2 text-lg font-semibold text-gray-800">{{ resident.get_full_name }}</dd>
                    </div>
                    <div class="grid grid-cols-3 gap-x-4">
                        <dt class="col-span-1 text-gray-500 text-lg font-semibold">Email:</dt>
                        <dd class="col-span-2 text-lg font-semibold text-gray-800">{{ resident.email }}</dd>
                    </div>
                    <div class="grid grid-cols-3 gap-x-4">
                        <dt class="col-span-1 text-gray-500 text-lg font-semibold">Contact No.:</dt>
                        <dd class="col-span-2 text-lg font-semibold text-gray-800">{{ resident.phone_number }}</dd>
                    </div>
                    <div class="grid grid-cols-3 gap-x-4">
                        <dt class="col-span-1 text-gray-500 text-lg font-semibold">Address:</dt>
                        <dd class="col-span-2 text-lg font-semibold text-gray-800">{{ resident.address }}</dd>
                    </div>
                    <div class="grid grid-cols-3 gap-x-4">
                        <dt class="col-span-1 text-gray-500 text-lg font-semibold">Birthday:</dt>
                        <dd class="col-span-2 text-lg font-semibold text-gray-800">{{ resident.birthday|date:"F d, Y" }}</dd>
                    </div>
                    <div class="grid grid-cols-3 gap-x-4">
                        <dt class="col-span-1 text-gray-500 text-lg font-semibold">Gender:</dt>
                        <dd class="col-span-2 text-lg font-semibold text-gray-800">{{ resident.gender }}</dd>
                    </div>
                </dl>
            </div>
        </div>
        
        <!-- RIGHT SIDE: ID Verification & Actions -->
        <div class="space-y-6">
            <div>
                <h3 class="font-bold text-lg text-gray-700 border-b pb-2 mb-3">Uploaded Valid ID</h3>
                {% if resident.id_image and resident.id_image.url %}
                    <button @click="isIdModalOpen = true" class="block w-full border-2 border-dashed rounded-lg p-2 hover:border-blue-500 transition">
                        <img src="{{ resident.id_image.url }}" alt="Resident ID" class="w-full rounded">
                    </button>
                    <p class="text-xs text-center text-gray-500 mt-2">Click image to enlarge</p>
                {% else %}
                    <div class="p-4 text-center bg-gray-100 rounded-lg"><p class="text-sm text-gray-500">No ID was uploaded for this account.</p></div>
                {% endif %}
            </div>
            
            <!-- ACTION BUTTONS -->
            <div class="border-t pt-6">
                <h3 class="font-bold text-lg text-gray-700 mb-3">Actions</h3>
                <form method="POST" class="space-y-4">
                    {% csrf_token %}
                    <p class="text-sm text-gray-600">Once verified, click "Approve" to activate the account. The resident will be notified via email.</p>
                    <div class="flex gap-4">
                        <button type="submit" name="reject" class="w-full bg-red-600 hover:bg-red-700 text-white font-bold py-2 px-4 rounded-lg">Reject</button>
                        <button type="submit" name="approve" class="w-full bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-4 rounded-lg">Approve</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- ID IMAGE MODAL (para sa enlarge) -->
    <div x-show="isIdModalOpen" x-transition.opacity class="fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/70" style="display: none;">
        <div @click.outside="isIdModalOpen = false" class="relative">
            <button @click="isIdModalOpen = false" class="absolute -top-4 -right-4 text-white text-3xl">&times;</button>
            {% if resident.id_image %}
            <img src="{{ resident.id_image.url }}" alt="Resident ID" 
                    class="rounded-lg w-full object-cover border-2 border-gray-200 hover:border-blue-500 transition-all cursor-pointer">
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}