{% extends "official_portal/base_official.html" %}

{% block official_title %}Notifications{% endblock %}

{% block official_content_main %}
<div class="max-w-3xl mx-auto bg-white p-6 md:p-8 rounded-lg shadow-xl border border-gray-100">

    <!-- HEADER -->
    <div class="flex items-center justify-between mb-6 border-b pb-4">
        <h1 class="text-3xl font-extrabold text-gray-900 flex items-center">
            <i class="fas fa-bell text-indigo-600 mr-3"></i>
            Notifications
        </h1>
        <!-- Removed "Clear All" button as requested -->
    </div>

    <!-- NOTIFICATION LIST -->
    <div class="flow-root">
        <ul role="list" class="-mb-6 divide-y divide-gray-200">
            {% for notif in notifications %}
            <li class="py-4">
                <div class="relative flex items-start space-x-4">
                    <!-- Icon -->
                    <div class="flex-shrink-0 pt-0.5">
                        <span class="h-10 w-10 rounded-full flex items-center justify-center
                            {% if 'pending' in notif.message|lower %} bg-yellow-100 text-yellow-700
                            {% elif 'approved' in notif.message|lower %} bg-green-100 text-green-700
                            {% elif 'rejected' in notif.message|lower %} bg-red-100 text-red-700
                            {% elif 'new' in notif.message|lower or 'assigned' in notif.message|lower %} bg-blue-100 text-blue-700
                            {% else %} bg-gray-100 text-gray-700 {% endif %}">
                            <!-- Dynamic Icons based on keywords (example) -->
                            {% if 'pending' in notif.message|lower %} <i class="fas fa-clock"></i>
                            {% elif 'approved' in notif.message|lower %} <i class="fas fa-check-circle"></i>
                            {% elif 'rejected' in notif.message|lower %} <i class="fas fa-times-circle"></i>
                            {% elif 'new' in notif.message|lower %} <i class="fas fa-plus-circle"></i>
                            {% elif 'assigned' in notif.message|lower %} <i class="fas fa-user-tag"></i>
                            {% elif 'document' in notif.message|lower %} <i class="fas fa-file-alt"></i>
                            {% else %} <i class="fas fa-info-circle"></i> {% endif %}
                        </span>
                    </div>
                    <!-- Content -->
                    <div class="min-w-0 flex-1">
                        <!-- Added data-notification-id for JS, and a custom class for easier selection -->
                        <a href="{{ notif.link|default:'#' }}"
                           class="notification-item block p-4 rounded-lg cursor-pointer
                                  {% if not notif.is_read %}bg-blue-50 border border-blue-200 shadow-sm{% else %}bg-gray-50 border border-gray-100{% endif %}
                                  transition-all duration-200 hover:shadow-md"
                           data-notification-id="{{ notif.id }}" {% if notif.link %}target="_blank"{% endif %}> {# Added target="_blank" for links #}
                            <p class="text-base text-gray-800 font-medium leading-relaxed">
                                {{ notif.message }}
                            </p>
                            <p class="text-sm text-gray-500 mt-1 font-normal">
                                <i class="fas fa-clock mr-1"></i> {{ notif.timestamp|timesince }} ago
                            </p>
                            {% if notif.link %}
                                <span class="text-sm font-semibold text-blue-700 hover:text-blue-800 mt-3 inline-flex items-center group">
                                    Take Action
                                    <i class="fas fa-arrow-right ml-2 group-hover:translate-x-1 transition-transform duration-200 ease-in-out"></i>
                                </span>
                            {% endif %}
                        </a>
                    </div>
                </div>
            </li>
            {% empty %}
            <div class="text-center py-12 text-gray-500">
                <i class="fas fa-check-circle text-5xl text-green-500 mb-4"></i>
                <p class="mt-3 text-xl font-semibold text-gray-700">All Caught Up!</p>
                <p class="text-md text-gray-500">You have no new notifications at the moment.</p>
            </div>
            {% endfor %}
        </ul>
    </div>
</div>
{% endblock %}

{% block official_extra_js %}
<script>
$(document).ready(function() {
    $('.notification-item').on('click', function(e) {
        e.preventDefault(); // Prevent the default link behavior for a moment

        var $this = $(this);
        var notificationId = $this.data('notification-id');
        var originalLink = $this.attr('href');

        // Optional: If you want to mark it as read on the server
        // You would typically send an AJAX request here
        // $.ajax({
        //     url: '/api/notifications/' + notificationId + '/mark_as_read/', // Replace with your actual API endpoint
        //     method: 'POST',
        //     data: { 'csrfmiddlewaretoken': '{{ csrf_token }}' }, // If using Django and need CSRF
        //     success: function(response) {
        //         console.log('Notification marked as read:', notificationId);
        //     },
        //     error: function(error) {
        //         console.error('Error marking notification as read:', error);
        //     }
        // });

        // Change background color to light gray (or white) and remove border
        $this.removeClass('bg-blue-50 border-blue-200').addClass('bg-gray-50 border-gray-100');
        $this.find('.text-blue-700').removeClass('text-blue-700').addClass('text-gray-600'); // Change link color too

        // If there was an actual link, navigate to it after the visual change
        if (originalLink && originalLink !== '#') {
            window.open(originalLink, $this.attr('target')); // Open in new tab if target="_blank"
        }
    });
});
</script>
{% endblock %}