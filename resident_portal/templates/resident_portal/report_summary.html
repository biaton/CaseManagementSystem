{% extends "resident_portal/base_resident.html" %}
{% load static %}
{% block title %}Case Summary: {{ case.blotter_id }}{% endblock %}

{% block content %}
<div class="bg-white p-6 md:p-8 rounded-lg shadow-md border">
    
    <!-- HEADER -->
    <div class="flex flex-col sm:flex-row items-start sm:items-center sm:justify-between mb-6 border-b pb-4">
        <div>
            <h1 class="text-2xl font-bold text-gray-800">Case Summary & Details</h1>
            <p class="text-sm text-gray-500 mt-1">Case ID: <span class="font-mono bg-gray-100 px-2 py-1 rounded">{{ case.blotter_id }}</span></p>
        </div>
        <div class="mt-4 sm:mt-0 text-right">
            <p class="text-xs text-gray-500">Current Status</p>
            <span class="px-3 py-1.5 inline-flex text-sm leading-5 font-bold rounded-full 
                {% if case.status == 'Certified' %}bg-green-100 text-green-800
                {% elif case.status == 'Dismissed' or case.status == 'Withdrawn' %}bg-red-100 text-red-800
                {% else %}bg-blue-100 text-blue-800{% endif %}">
                {{ case.get_status_display }}
            </span>
        </div>
    </div>
    
    <!-- ======================================================= -->
    <!-- DETAILED INFORMATION GRID (ITO ANG BAGO) -->
    <!-- ======================================================= -->
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8">
        <!-- LEFT SIDE: Complainant & Incident Details -->
        <div class="space-y-6">
            <!-- Complainant Details -->
            <div>
                <h3 class="font-bold text-lg text-gray-700 border-b pb-2 mb-3">Your Information (Complainant)</h3>
                <dl class="text-sm space-y-2">
                    <div class="grid grid-cols-3 gap-x-4"><dt class="col-span-1 text-gray-500">Full Name:</dt><dd class="col-span-2 font-medium text-gray-800">{{ case.complainant.get_full_name }} {{ case.complainant_suffix }}</dd></div>
                    <div class="grid grid-cols-3 gap-x-4"><dt class="col-span-1 text-gray-500">Address:</dt><dd class="col-span-2 font-medium text-gray-800">{{ case.complainant.address }}</dd></div>
                    <div class="grid grid-cols-3 gap-x-4"><dt class="col-span-1 text-gray-500">Contact No.:</dt><dd class="col-span-2 font-medium text-gray-800">{{ case.complainant_contact_number }}</dd></div>
                </dl>
            </div>
            <!-- Incident Details -->
            <div>
                <h3 class="font-bold text-lg text-gray-700 border-b pb-2 mb-3">Incident Details</h3>
                <dl class="text-sm space-y-2">
                    <div class="grid grid-cols-3 gap-x-4"><dt class="col-span-1 text-gray-500">Incident Type:</dt><dd class="col-span-2 font-medium text-gray-800">{{ case.get_incident_type_display }}</dd></div>
                    <div class="grid grid-cols-3 gap-x-4"><dt class="col-span-1 text-gray-500">Date of Incident:</dt><dd class="col-span-2 font-medium text-gray-800">{{ case.date_of_incident|date:"F d, Y" }}</dd></div>
                    <div class="grid grid-cols-3 gap-x-4"><dt class="col-span-1 text-gray-500">Location:</dt><dd class="col-span-2 font-medium text-gray-800">{{ case.location_of_incident }}</dd></div>
                </dl>
            </div>
        </div>

        <!-- RIGHT SIDE: Respondent & Narrative -->
        <div class="space-y-6">
             <!-- Respondent Details -->
            <div>
                <h3 class="font-bold text-lg text-gray-700 border-b pb-2 mb-3">Respondent's Information</h3>
                <dl class="text-sm space-y-2">
                    <div class="grid grid-cols-3 gap-x-4"><dt class="col-span-1 text-gray-500">Full Name:</dt><dd class="col-span-2 font-medium text-gray-800">{{ case.respondent_first_name }} {{ case.respondent_middle_name }} {{ case.respondent_last_name }}</dd></div>
                    <div class="grid grid-cols-3 gap-x-4"><dt class="col-span-1 text-gray-500">Address:</dt><dd class="col-span-2 font-medium text-gray-800">{{ case.respondent_address }}</dd></div>
                </dl>
            </div>
             <!-- Narrative -->
            <div>
                <h3 class="font-bold text-lg text-gray-700 border-b pb-2 mb-3">Incident Description</h3>
                <div class="p-4 bg-gray-50 rounded-lg text-gray-700 leading-relaxed text-sm">
                    {{ case.incident_description|linebreaksbr }}
                </div>
            </div>
            <!-- Uploaded Image -->
            {% if case.incident_image %}
            <div>
                <h3 class="font-bold text-lg text-gray-700 border-b pb-2 mb-3">Attached Evidence</h3>
                <a href="{{ case.incident_image.url }}" target="_blank">
                    <img src="{{ case.incident_image.url }}" alt="Uploaded Evidence" class="rounded-lg border max-h-48">
                </a>
            </div>
            {% endif %}
        </div>
    </div>


    <!-- CASE HISTORY / TIMELINE -->
    <div class="mt-8 pt-6 border-t">
        <h2 class="text-xl font-semibold text-gray-700 mb-6">Case History & Timeline</h2>
        <ol class="relative border-l border-gray-200 ml-2">                  
            {% for log in logs %}
            <li class="mb-10 ml-6">
                <span class="absolute flex items-center justify-center w-6 h-6 bg-blue-100 rounded-full -left-3 ring-8 ring-white">
                    <i class="fas fa-check text-blue-600"></i>
                </span>
                <h3 class="flex items-center mb-1 text-lg font-semibold text-gray-900">{{ log.case_title }}</h3>
                <time class="block mb-2 text-sm font-normal leading-none text-gray-400">on {{ log.date_processed|date:"F d, Y, P" }}</time>
                {% if log.remarks %}
                <p class="mb-4 text-base font-normal text-gray-500">{{ log.remarks }}</p>
                {% endif %}
            </li>
            {% empty %}
             <li class="ml-4"><p class="text-gray-500">No actions have been logged for this case yet.</p></li>
            {% endfor %}
            <li class="mb-10 ml-6">
                <span class="absolute flex items-center justify-center w-6 h-6 bg-gray-100 rounded-full -left-3 ring-8 ring-white">
                    <i class="fas fa-file-alt text-gray-600"></i>
                </span>
                 <h3 class="text-lg font-semibold text-gray-900">Case Filed</h3>
                <time class="block mb-2 text-sm font-normal leading-none text-gray-400">on {{ case.date_filed|date:"F d, Y, P" }}</time>
            </li>
        </ol>
    </div>

    <!-- Back Button -->
    <div class="mt-8 border-t pt-6">
        <a href="{% url 'resident_portal:my_blotters_list' %}" class="inline-flex items-center bg-gray-600 text-white font-semibold py-2 px-4 rounded-lg hover:bg-gray-700">
            <i class="fas fa-arrow-left mr-2"></i>
            Back to My Blotter Cases
        </a>
    </div>
</div>
{% endblock %}