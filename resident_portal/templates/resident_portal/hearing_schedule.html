{% extends "resident_portal/base_resident.html" %}
{% load static %}
{% block title %}Hearing Schedules{% endblock %}

{% block extra_head %}
<style>
    @media print {
        body * { visibility: hidden; }
        #printable-paper, #printable-paper * { visibility: visible; }
        #printable-paper { position: absolute; left: 0; top: 0; width: 100%; }
        .no-print { display: none !important; }
        @page { size: A4; margin: 0.75in; }
    }
</style>
{% endblock %}

{% block content %}
<div x-data="{
    selectedSchedule: null,
    get paperTitle() {
        if (!this.selectedSchedule) return 'NOTICE';
        if (this.selectedSchedule.type === 'Summon') return 'SUMMONS';
        return `NOTICE OF ${this.selectedSchedule.type.toUpperCase()}`;
    },
    get paperDate() {
        if (!this.selectedSchedule) return '[DATE]';
        return new Date(this.selectedSchedule.date).toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' });
    },
    get paperTime() {
        if (!this.selectedSchedule) return '[TIME]';
        const [h, m] = this.selectedSchedule.time.split(':');
        const d = new Date(); d.setHours(h); d.setMinutes(m);
        return d.toLocaleTimeString('en-US', { hour: 'numeric', minute: '2-digit', hour12: true });
    }
}">
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-5">
        <!-- LEFT SIDE: List of Schedules -->
        <div class="bg-white p-6 rounded-lg shadow-md border">
            <div class="mb-6"><a href="{% url 'resident_portal:my_blotters_list' %}" class="text-sm text-blue-600 hover:underline">‚Üê Back to My Blotter Cases</a></div>
            <h2 class="text-2xl font-bold">Hearing Schedules for Case: {{ case.blotter_id }}</h2>
            <ul class="mt-6 space-y-4">
                {% for schedule in schedules %}
                <li class="p-4 border rounded-lg flex justify-between items-center">
                    <div>
                        <p class="font-bold text-lg text-indigo-700">{{ schedule.schedule_type }}</p>
                        <p><strong>Date:</strong> {{ schedule.appearance_date|date:"F d, Y" }}</p>
                        <p><strong>Time:</strong> {{ schedule.appearance_time|time:"g:i A" }}</p>
                    </div>
                    <button @click="selectedSchedule = {
                        type: '{{ schedule.schedule_type }}',
                        date: '{{ schedule.appearance_date|date:'Y-m-d' }}',
                        time: '{{ schedule.appearance_time|time:'H:i' }}'
                    }" class="bg-blue-100 text-blue-700 font-semibold py-1 px-3 rounded-full text-sm hover:bg-blue-200">
                        View Notice
                    </button>
                </li>
                {% empty %}
                <p>No hearing schedules have been set for this case yet.</p>
                {% endfor %}
            </ul>
        </div>

        <!-- RIGHT SIDE: Printable Paper -->
        <div class="lg:col-span-1">
            <div class="flex justify-end mb-4 no-print">
                <button onclick="window.print()" class="bg-gray-700 text-white font-bold py-2 px-4 rounded-lg hover:bg-gray-800"><i class="fas fa-print mr-2"></i>Print Notice</button>
            </div>
            <div id="printable-paper" class="bg-white p-10 shadow-xl border font-serif text-sm">
                <div id="printable-paper" class="bg-white p-8 rounded-lg shadow-md border-2 border-gray-300 font-serif text-sm">
                <!-- Header -->
                <div class="flex justify-between items-center border-b-2 border-black pb-4">
                    <img src="{% static 'images/city_logo.png' %}" alt="Logo" class="img-fluid" style="max-width: 105px;">
                    <div class="text-center">
                        <p class="font-semibold">Republic of the Philippines</p>
                        <p class="font-semibold">City of Mandaluyong</p>
                        <h1 class="text-2xl font-bold">BARANGAY ADDITION HILLS</h1>
                        <p class="font-semibold">OFFICE OF THE LUPONG TAGAPAMAYAPA</p>
                    </div>
                    <img src="{% static 'images/barangay_seal.png' %}" alt="Logo" class="img-fluid" style="max-width: 100px;">
                </div>

                <table class="w-full mt-6 text-left">
                    <tr><td class="w-2/3"><p class="font-bold">{{ case.complainant.get_full_name|upper }}</p><p class="border-t border-black mr-4">Complainant/s</p></td><td class="w-1/3" rowspan="2"><p class="font-bold">Case No.</p><p class="border-b border-black text-center">{{ case.blotter_id }}</p><p class="font-bold mt-2">For:</p><p class="border-b border-black text-center">{{ case.get_incident_type_display }}</p></td></tr>
                    <tr><td><p class="font-bold text-center text-lg italic">- against -</p><p class="font-bold">{{ case.respondent_first_name|upper }} {{ case.respondent_last_name|upper }}</p><p class="border-t border-black mr-4">Respondent/s</p></td></tr>
                </table>
                <!-- I-paste mo dito ang buong #printable-paper div mula sa official_portal/create_schedule.html -->
                <!-- Pero papalitan natin ang mga placeholders ng Alpine.js variables -->
                <div class="text-center"><h2 class="text-3xl font-bold my-8 tracking-widest" x-text="paperTitle"></h2></div>
                <div class="space-y-4">
                    <p>You are hereby required to appear before me on the <strong class="underline" x-text="selectedProceeding.day"></strong> day of <strong class="underline" x-text="selectedProceeding.month"></strong>, <strong class="underline" x-text="selectedProceeding.year"></strong> at <strong class="underline" x-text="selectedProceeding.time"></strong> for the hearing of your case.</p>
                    <p>This <span class="underline">__</span> day of <span class="underline">________</span>, 20<span class="underline">__</span>.</p>
                </div>
                <footer class="mt-16 text-right"><div class="inline-block text-center"><p class="font-bold border-t border-black px-8">HON. [PUNONG BARANGAY NAME]</p><p>Punong Barangay / Pangkat Chairman</p></div></footer>
            </div>
        </div>
    </div>
</div>
{% endblock %}