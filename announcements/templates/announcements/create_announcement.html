{% extends "official_portal/base_official.html" %}
{% load static %}

{% block official_title %}Create New Announcement{% endblock %}

{% block extra_head_official %}
    <!-- Quill.js Theme: Snow -->
    <link href="https://cdn.jsdelivr.net/npm/quill@2.0.2/dist/quill.snow.css" rel="stylesheet" />
    <style>
        #editor-container { 
            height: 350px; 
            background-color: #fff;
        }
        /* Border at kulay ng Quill toolbar at container */
        .ql-toolbar.ql-snow {
            border: 1px solid #d1d5db; /* border-gray-300 */
            border-top-left-radius: 0.5rem; /* rounded-t-lg */
            border-top-right-radius: 0.5rem;
            background-color: #f9fafb; /* bg-gray-50 */
        }
        .ql-container.ql-snow {
            border: 1px solid #d1d5db;
            border-bottom-left-radius: 0.5rem; /* rounded-b-lg */
            border-bottom-right-radius: 0.5rem;
            font-size: 1rem;
            color: #1f2937; /* text-gray-800 */
        }

        /* --- CSS para sa Font Whitelist ng Quill --- */
        .ql-snow .ql-picker.ql-font .ql-picker-label[data-value="arial"]::before,
        .ql-snow .ql-picker.ql-font .ql-picker-item[data-value="arial"]::before { content: 'Arial'; font-family: "Arial", sans-serif; }
        .ql-font-arial { font-family: "Arial", sans-serif; }
        .ql-snow .ql-picker.ql-font .ql-picker-label[data-value="comic-sans"]::before,
        .ql-snow .ql-picker.ql-font .ql-picker-item[data-value="comic-sans"]::before { content: 'Comic Sans'; font-family: "Comic Sans MS", cursive; }
        .ql-font-comic-sans { font-family: "Comic Sans MS", cursive; }
        .ql-snow .ql-picker.ql-font .ql-picker-label[data-value="courier-new"]::before,
        .ql-snow .ql-picker.ql-font .ql-picker-item[data-value="courier-new"]::before { content: 'Courier New'; font-family: "Courier New", monospace; }
        .ql-font-courier-new { font-family: "Courier New", monospace; }
        .ql-snow .ql-picker.ql-font .ql-picker-label[data-value="georgia"]::before,
        .ql-snow .ql-picker.ql-font .ql-picker-item[data-value="georgia"]::before { content: 'Georgia'; font-family: "Georgia", serif; }
        .ql-font-georgia { font-family: "Georgia", serif; }
        .ql-snow .ql-picker.ql-font .ql-picker-label[data-value="helvetica"]::before,
        .ql-snow .ql-picker.ql-font .ql-picker-item[data-value="helvetica"]::before { content: 'Helvetica'; font-family: "Helvetica", sans-serif; }
        .ql-font-helvetica { font-family: "Helvetica", sans-serif; }
        .ql-snow .ql-picker.ql-font .ql-picker-label[data-value="lucida-grande"]::before,
        .ql-snow .ql-picker.ql-font .ql-picker-item[data-value="lucida-grande"]::before { content: 'Lucida Grande'; font-family: "Lucida Grande", sans-serif; }
        .ql-font-lucida-grande { font-family: "Lucida Grande", sans-serif; }
        .ql-snow .ql-picker.ql-font .ql-picker-label[data-value="tahoma"]::before,
        .ql-snow .ql-picker.ql-font .ql-picker-item[data-value="tahoma"]::before { content: 'Tahoma'; font-family: "Tahoma", sans-serif; }
        .ql-font-tahoma { font-family: "Tahoma", sans-serif; }
        .ql-snow .ql-picker.ql-font .ql-picker-label[data-value="times-new-roman"]::before,
        .ql-snow .ql-picker.ql-font .ql-picker-item[data-value="times-new-roman"]::before { content: 'Times New Roman'; font-family: "Times New Roman", serif; }
        .ql-font-times-new-roman { font-family: "Times New Roman", Times, serif; }
        .ql-snow .ql-picker.ql-font .ql-picker-label[data-value="verdana"]::before,
        .ql-snow .ql-picker.ql-font .ql-picker-item[data-value="verdana"]::before { content: 'Verdana'; font-family: "Verdana", sans-serif; }
        .ql-font-verdana { font-family: "Verdana", sans-serif; }
        /* --- Wakas ng CSS --- */
    </style>
{% endblock %}

{% block official_content_main %}
<div class="bg-white p-6 md:p-8 rounded-lg shadow-md border">
    
    <!-- HEADER SECTION -->
    <div class="flex flex-col sm:flex-row items-start sm:items-center sm:justify-between mb-6 border-b border-gray-200 pb-5">
        <div>
            <h2 class="text-2xl font-bold text-gray-800 flex items-center">
                <i class="bi bi-megaphone-fill text-blue-600 mr-3"></i>
                Create a New Announcement
            </h2>
            <p class="mt-1 text-sm text-gray-500">Compose and publish new updates for residents.</p>
        </div>
        <div class="mt-4 sm:mt-0">
            <!-- Pinalitan ko ang URL name para tumugma sa setup natin -->
            <a href="{% url 'announcements:list' %}" class="bg-gray-200 hover:bg-gray-300 text-gray-800 font-semibold py-2 px-4 rounded-lg inline-flex items-center text-sm transition-colors">
                <i class="bi bi-card-list mr-2"></i>
                View All Announcements
            </a>
        </div>
    </div>
    
    <!-- Pinalitan ko ang action para tumugma sa setup natin -->
    <form id="announcement-form" method="POST" action="{% url 'announcements:create' %}" enctype="multipart/form-data">
        {% csrf_token %}
        
        <div class="space-y-6">
            <!-- Title Field -->
            <div>
                <label for="{{ form.title.id_for_label }}" class="block text-sm font-medium leading-6 text-gray-900">Title</label>
                <div class="mt-2">
                    {{ form.title }}
                </div>
            </div>

            <!-- Featured Image Field -->
            <div>
                <label for="{{ form.featured_image.id_for_label }}" class="block text-sm font-medium leading-6 text-gray-900">Featured Image</label>
                <div class="mt-2">
                    {{ form.featured_image }}
                </div>
                <p class="mt-2 text-xs text-gray-500">This image will be shown on the announcement card. (Optional)</p>
            </div>

            <!-- is_published Checkbox -->
             <div>
                <label for="{{ form.is_published.id_for_label }}" class="flex items-center text-sm font-medium leading-6 text-gray-900">
                    {{ form.is_published }}
                    <span class="ml-2">Publish this announcement immediately</span>
                </label>
                <p class="mt-1 ml-6 text-xs text-gray-500">If unchecked, this will be saved as a draft.</p>
            </div>

            <!-- Quill.js Editor -->
            <div>
                <label class="block text-sm font-medium leading-6 text-gray-900 mb-2">Content</label>
                <div id="editor-container">
                    <!-- I-populate natin ang editor kung may existing data (para sa edit page sa future) -->
                    {{ form.content.value|safe|default:'' }}
                </div>
                <!-- Hidden input na lalagyan ng content ng Quill -->
                <div style="display:none;">{{ form.content }}</div>
            </div>
        </div>

        <div class="mt-8 flex items-center justify-end gap-x-4 border-t border-gray-200 pt-6">
            <a href="{% url 'announcements:list' %}" class="text-sm font-semibold leading-6 text-gray-900">Cancel</a>
            <button type="submit" class="rounded-md bg-indigo-600 px-4 py-2 text-sm font-semibold text-white shadow-sm hover:bg-indigo-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-600">
                <i class="bi bi-send-fill mr-2"></i>Publish Announcement
            </button>
        </div>
    </form>
</div>
{% endblock %}

{% block extra_scripts_official %}
    <!-- Quill.js Core Library -->
    <script src="https://cdn.jsdelivr.net/npm/quill@2.0.2/dist/quill.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // --- Quill.js Initialization ---
            const Font = Quill.import('formats/font');
            Font.whitelist = ['sans-serif', 'serif', 'monospace', 'arial', 'comic-sans', 'courier-new', 'georgia', 'helvetica', 'lucida-grande', 'tahoma', 'times-new-roman', 'verdana'];
            Quill.register(Font, true);

            const toolbarOptions = [
                [{ 'header': [1, 2, 3, 4, false] }],
                [{ 'font': Font.whitelist }],
                ['bold', 'italic', 'underline', 'strike'],
                [{ 'list': 'ordered'}, { 'list': 'bullet' }],
                [{ 'align': [] }],
                ['link', 'image', 'blockquote', 'code-block'],
                [{ 'color': [] }, { 'background': [] }],
                ['clean']
            ];

            const quill = new Quill('#editor-container', {
                modules: { toolbar: toolbarOptions },
                theme: 'snow',
                placeholder: 'Write your announcement here...'
            });

            // --- Sync Quill.js with a Django form ---
            const form = document.getElementById('announcement-form');
            const contentInput = document.getElementById('id_content');

            form.addEventListener('submit', function(event) {
                contentInput.value = quill.root.innerHTML;
            });
        });
    </script>
{% endblock %}