{% extends "official_portal/base_official.html" %}

{% block official_title %}Lupon Tagapamayapa Report{% endblock %}

{% block extra_head_official %}
<style>
    /* Ito ang magic para sa print. */
    @media print {
        @page {
            size: landscape; /* Landscape para mas maluwag */
            margin: 0.5in;
        }
        body * {
            visibility: hidden;
        }
        #printable-area, #printable-area * {
            visibility: visible;
        }
        #printable-area {
            position: absolute;
            left: 0;
            top: 0;
            width: 100%;
            margin: 0;
            padding: 20px;
        }
        .no-print {
            display: none !important;
        }
         /* Pilitin na magkaroon ng background colors sa print */
        th, td {
            -webkit-print-color-adjust: exact !important; 
            print-color-adjust: exact !important;
        }
        .print-bg-green-50 { background-color: #f0fdf4 !important; }
        .print-bg-green-100 { background-color: #dcfce7 !important; }
        .print-bg-green-200 { background-color: #bbf7d0 !important; }
        .print-bg-yellow-50 { background-color: #fefce8 !important; }
        .print-bg-yellow-100 { background-color: #fef9c3 !important; }
        .print-bg-yellow-200 { background-color: #fef08a !important; }
        .print-bg-slate-50 { background-color: #f8fafc !important; }
        .print-bg-slate-100 { background-color: #f1f5f9 !important; }
    }
</style>
{% endblock %}

{% block official_content_main %}
<div class="bg-white p-4 sm:p-6 rounded-2xl shadow-lg border">
    
    <!-- HEADER (Ito ay hindi mapiprint) -->
    <div class="flex flex-col sm:flex-row items-start sm:items-center sm:justify-between mb-6 border-b border-gray-200 pb-5 no-print">
        <div>
            <h2 class="text-3xl font-extrabold text-gray-900">Lupon Tagapamayapa Report</h2>
            <p class="text-sm text-gray-500 mt-1">Monthly summary of actions taken by the Lupong Tagapamayapa.</p>
        </div>
        <div class="mt-4 sm:mt-0 flex items-center gap-4">
            <form method="GET" class="flex items-center gap-2">
                <select name="year" onchange="this.form.submit()" class="py-2 pl-3 pr-8 border border-gray-300 bg-white rounded-md shadow-sm text-sm">
                    {% for year_option in years %}
                        <option value="{{ year_option }}" {% if year_option == selected_year|add:0 %}selected{% endif %}>{{ year_option }}</option>
                    {% endfor %}
                </select>
            </form>
            <button onclick="window.print()" class="bg-gray-700 text-white font-semibold py-2 px-4 rounded-lg inline-flex items-center text-sm">
                <i class="fas fa-print mr-2"></i>Print
            </button>
        </div>
    </div>
    
    <!-- LUPON REPORT TABLE AREA (ITO ANG IPI-PRINT) -->
    <div id="printable-area">
        <!-- Report Header (lalabas lang sa print) -->
        <div class="text-center mb-6 hidden print:block">
            <h3 class="text-xl font-bold text-black">BARANGAY ADDITION HILLS</h3>
            <h4 class="text-lg font-semibold text-black">ACTIONS TAKEN BY THE LUPONG TAGAPAMAYAPA</h4>
            <p class="text-lg font-semibold text-black">Monthly Report for the Year {{ selected_year }}</p>
        </div>

        <div class="overflow-x-auto rounded-lg border">
            <table class="min-w-full text-sm text-center">
                <thead class="bg-slate-100 font-semibold print-bg-slate-100">
                    <tr>
                        <th rowspan="2" class="p-1 border">BARANGAY</th>
                        <th colspan="3" class="p-2 border bg-green-100 print-bg-green-100">SETTLED CASES</th>
                        <th rowspan="2" class="p-2 border bg-green-200 print-bg-green-200">TOTAL</th>
                        <th colspan="4" class="p-2 border bg-yellow-100 print-bg-yellow-100">UNSETTLED CASES</th>
                        <th rowspan="2" class="p-2 border bg-yellow-200 print-bg-yellow-200">TOTAL</th>
                    </tr>
                    <tr>
                        <th class="p-2 border bg-green-50 print-bg-green-50">SUMMON</th>
                        <th class="p-2 border bg-green-50 print-bg-green-50">MEDIATION</th>
                        <th class="p-2 border bg-green-50 print-bg-green-50">CONCILIATION</th>
                        <th class="p-2 border bg-yellow-50 print-bg-yellow-50">REPUDIATED</th>
                        <th class="p-2 border bg-yellow-50 print-bg-yellow-50">WITHDRAWN</th>
                        <th class="p-2 border bg-yellow-50 print-bg-yellow-50">DISMISSED</th>
                        <th class="p-2 border bg-yellow-50 print-bg-yellow-50">CERTIFIED</th>
                    </tr>
                </thead>
                <tbody class="divide-y divide-gray-200">
                    {% for month in months_data %}
                    <tr>
                        <td class="p-1 border font-semibold">{{ month.name|upper }}</td>
                        <td class="p-2 border">{{ month.summon }}</td>
                        <td class="p-2 border">{{ month.mediation }}</td>
                        <td class="p-2 border">{{ month.conciliation }}</td>
                        <td class="p-2 border font-bold bg-slate-50 print-bg-slate-50">{{ month.mediation|add:month.conciliation }}</td>
                        <td class="p-2 border">{{ month.repudiated }}</td>
                        <td class="p-2 border">{{ month.withdrawn }}</td>
                        <td class="p-2 border">{{ month.dismissed }}</td>
                        <td class="p-2 border">{{ month.certified }}</td>
                        <td class="p-2 border font-bold bg-slate-50 print-bg-slate-50">{{ month.repudiated|add:month.withdrawn|add:month.dismissed|add:month.certified }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
                <!-- Pwede dito ilagay ang quarterly at annual totals sa future -->
            </table>
        </div>
    </div>
</div>
{% endblock %}